

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Returning from mapping &mdash; field tech 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="OpenDroneMap distributed processing" href="../passel/" />
    <link rel="prev" title="Mapping" href="../use/" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../" class="icon icon-home"> field tech
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../principles/">Humanitarian principles</a></li>
</ul>
<p class="caption"><span class="caption-text">ODK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../odk/intro/">Open Data Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../odk/media/">ODK in the RCRC network</a></li>
</ul>
<p class="caption"><span class="caption-text">ODK2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../odk2/intro/">Open Data Kit 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../odk2/rc2relief/">RC2 Relief Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">POSM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Getting a POSM</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../offline-mapping/">Offline OSM mapping</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../preparation/">Preparing for mapping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../use/">Mapping</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Returning from mapping</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#omk-server-josm-osm">OMK Server &gt; JOSM &gt; OSM</a></li>
<li class="toctree-l3"><a class="reference internal" href="#posm-replay">POSM replay</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../passel/">OpenDroneMap distributed processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">General troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../cloud/">Cloud Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../for-developers/">For Developers</a></li>
</ul>
<p class="caption"><span class="caption-text">OpenMapKit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../omk/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/survey-form/">Creating a survey form</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/osm-basemap/">Creating the OSM basemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/walkthrough/">Walkthrough</a></li>
</ul>
<p class="caption"><span class="caption-text">Street-level imagery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/sony-action-cam/">Sony action cameras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/mapillary/">Mapillary</a></li>
</ul>
<p class="caption"><span class="caption-text">Drones</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../drones/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drones/processing/">Imagery processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Use cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../use-cases/intro/">Introduction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">field tech</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../">Docs</a> &raquo;</li>
        
          <li><a href="../offline-mapping/">Offline OSM mapping</a> &raquo;</li>
        
      <li>Returning from mapping</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/posm/returning.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="returning-from-mapping">
<h1>Returning from mapping<a class="headerlink" href="#returning-from-mapping" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">This section is being edited and updated. Please let us know if you find any errors or omissions.</p>
</div>
<p>When you’re ready, collected data should be cleaned and uploaded to OSM. Between the time you created the AOI export to the time you are ready to push the data back, OSM users in online environments may have created changes to the map. Rather than overwriting those changes, you will need to go through a conflict detection and resolution process.</p>
<p>Ideally, you can do iterative mapping: use iD and JOSM to edit the OSM database extract stored locally on the POSM, render new deployment files and tiles, collect more data with Field Papers and OpenMapKit, and repeat. The accumulated edits would then need to be transferred from your local OSM to online OSM. To handle this, we’ve developed POSM replay.</p>
<div class="section" id="omk-server-josm-osm">
<h2>OMK Server &gt; JOSM &gt; OSM<a class="headerlink" href="#omk-server-josm-osm" title="Permalink to this headline">¶</a></h2>
<p>You can clean the data exported from OpenMapKit Server and upload to OSM (resolving conflicts while doing so) using JOSM.</p>
<p>For large amounts of data, there are certain tools and processes that can streamline data cleaning. We documented our <a class="reference external" href="https://github.com/AmericanRedCross/workflows/blob/master/west-africa_data-cleaning.md">data cleaning workflow</a> for a project in West Africa. This is project-specific but may be useful in guiding the development of your own workflow.</p>
<p>Here’s a short summary:</p>
<ol class="arabic simple">
<li>Retrieve the <code class="docutils literal notranslate"><span class="pre">.osm</span></code> file from OMK server and open in JOSM. Enable the
ToDoList and OpenData plug-ins for JOSM.</li>
<li>Purge non-relevant features (features that don’t need to be cleaned, or
features outside a geographic area where you want to focus) using
<code class="docutils literal notranslate"><span class="pre">CTRL+Shift+P</span></code>. <strong>Do not delete these features</strong>.</li>
<li>Save the points and polygons as separate files.</li>
<li>For point data: Clean any free-form text inputs. When entering data for
things like hospital names, town names, etc, enumerators sometimes use
different spelling of capitalization or include a typo. Use Open Refine to
clean these columns individually. Open Refine looks for responses that are
close but not exactly the same, and allows you to group these and change them
to a consistent spelling. Once you’re finished, export as a <code class="docutils literal notranslate"><span class="pre">.csv</span></code> file and
re-open in JOSM (<code class="docutils literal notranslate"><span class="pre">File</span> <span class="pre">-&gt;</span> <span class="pre">Open</span></code>, accept the coordinate system as WGS84). Make
sure the points appear to be in the correct place, add a source tag to all
your new features (e.g. <code class="docutils literal notranslate"><span class="pre">source=Red</span> <span class="pre">Cross</span> <span class="pre">survey</span></code>), then push the
changes to OSM.</li>
<li>For polygon data: This is more tedious. Open Refine doesn’t play nice with
XML input, so in the past we’ve cleaned the individual records in JOSM.
There’s room here for scoping out other data cleaning services or scripts
that might make it easier to convert from XML into a format that can be
digested through Open Refine and back again. Once you’ve cleaned the
polygons, add the source tag (see step 4), address any validation errors that
occur, and push to OSM.</li>
<li>Save the <code class="docutils literal notranslate"><span class="pre">.osm</span></code> files you uploaded, for future reference.</li>
</ol>
<p>These steps will push changes to the OSM data kept on your local POSM. This
means that you can create new Field Papers, OMK surveys, etc, which will
incorporate these changes for future rounds of mapping.</p>
<p>The local OSM copy is still separate from the online version, however, and will
need to be reconciled and synched when you return from the mapping area to an area with
internet connectivity.</p>
</div>
<div class="section" id="posm-replay">
<h2>POSM replay<a class="headerlink" href="#posm-replay" title="Permalink to this headline">¶</a></h2>
<p>We’ve never had a full workflow wherein people edited the local OSM database on the POSM via the iD editor and then needed to get it off. Some potential options are:</p>
<ul class="simple">
<li>download a snapshot of current data from the API querying the full AOI bounds - if done in JOSM, this can be loaded into a layer and either saved out or individual features copied into an OSM-backed layer</li>
<li>download OSC changes for each edit made (this is what the POSM Replay Tool does)</li>
<li>generate an OSM XML / PBF dump using Osmosis against the API DB (using the command line)</li>
<li>generate an OSM XML history dump using planet-dump-ng against pg_dump output (using the command line)</li>
<li>gather minutely diffs from <a class="reference external" href="http://posm.io/replication/">http://posm.io/replication/</a> (these are used for updating the rendering database)</li>
</ul>
<p>The POSM replay tool is intended to provide an efficient workflow, but requires some command line knowledge and familiarity with GitHub. <a class="reference external" href="https://twitter.com/awesomeposm">Reach out</a> if you get to this step and need some pointers.</p>
<p>The <a class="reference external" href="https://github.com/americanredcross/posm-replay-tool">complete instructions</a> and you can <a class="reference external" href="https://hi.stamen.com/merging-offline-edits-with-the-posm-replay-tool-2f39a4410d2a#.47nht8th2">read more</a> about the concepts and mechanics behind the process.</p>
<p>In general, the replay process works as follows:</p>
<ol class="arabic simple">
<li>Obtain an AOI extract (PBF or XML) corresponding to the point where the local OSM API branched from. (This is the PBF file you created through the AOI export and used to set up your POSM deployment )</li>
<li>Gather local changesets.</li>
<li>Initialize a git repository containing locally-modified entities present in the AOI extract.</li>
<li>Obtain an AOI extract containing current data from your upstream (use export.posm.io and follow the same steps you did to create your POSM deployment in the first place… but with current data).</li>
<li>Extract and apply changes to locally-modified entities from the current AOI extract.</li>
<li>Create a branch representing the local history by applying all local changesets to a branch containing the starting AOI extract.</li>
<li>Apply each local changeset to the branch containing the current AOI extract.</li>
<li>Manually resolve merge conflicts between local and upstream edits.</li>
<li>Submit resolved changesets to your upstream API, renumbering references to locally-created entities as necessary.</li>
</ol>
<p>We are still improving and fine-tuning this part of the POSM workflow, and we would be interested in your feedback and experience with it.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../passel/" class="btn btn-neutral float-right" title="OpenDroneMap distributed processing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../use/" class="btn btn-neutral" title="Mapping" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright  CC-BY American Red Cross

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>