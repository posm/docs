

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Cloud Installation &mdash; field tech 0.1 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="For Developers" href="../for-developers/" />
    <link rel="prev" title="General troubleshooting" href="../troubleshooting/" /> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../" class="icon icon-home"> field tech
          

          
          </a>

          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search/" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting-started/">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../principles/">Humanitarian principles</a></li>
</ul>
<p class="caption"><span class="caption-text">ODK</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../odk/intro/">Open Data Kit</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../odk/media/">ODK in the RCRC network</a></li>
</ul>
<p class="caption"><span class="caption-text">ODK2</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../odk2/intro/">Open Data Kit 2</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../odk2/rc2relief/">RC2 Relief Tool</a></li>
</ul>
<p class="caption"><span class="caption-text">POSM</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../setup/">Getting a POSM</a></li>
<li class="toctree-l1"><a class="reference internal" href="../offline-mapping/">Offline OSM mapping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../passel/">OpenDroneMap distributed processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../troubleshooting/">General troubleshooting</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Cloud Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#get-a-fully-qualified-domain-name">Get a Fully Qualified Domain Name</a></li>
<li class="toctree-l2"><a class="reference internal" href="#instance-setup">Instance Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-dns">Configure DNS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#posm-cloud-install">POSM Cloud Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="#omk-server-settings">OMK Server Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#success">Success</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../for-developers/">For Developers</a></li>
</ul>
<p class="caption"><span class="caption-text">OpenMapKit</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../omk/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/installation/">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/survey-form/">Creating a survey form</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/osm-basemap/">Creating the OSM basemap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../omk/walkthrough/">Walkthrough</a></li>
</ul>
<p class="caption"><span class="caption-text">Street-level imagery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/sony-action-cam/">Sony action cameras</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../street-level/mapillary/">Mapillary</a></li>
</ul>
<p class="caption"><span class="caption-text">Drones</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../drones/intro/">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../drones/processing/">Imagery processing</a></li>
</ul>
<p class="caption"><span class="caption-text">Use cases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../use-cases/intro/">Introduction</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">field tech</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../">Docs</a> &raquo;</li>
        
      <li>Cloud Installation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/posm/cloud.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="cloud-installation">
<h1>Cloud Installation<a class="headerlink" href="#cloud-installation" title="Permalink to this headline">¶</a></h1>
<div class="admonition-todo admonition" id="index-0">
<p class="first admonition-title">Todo</p>
<p class="last">This section needs to be edited and updated for the most recent release of POSM.</p>
</div>
<p>Interested in running POSM in the cloud? This type of setup is great for semi-connected instances when you want the integration of OpenMapKit/Field Papers/OSM but have more regular connectivity with your surveyors.</p>
<p>First, this guide will walk through how to set things up in Amazon Web Services, specifically EC2. If you like another flavor or cloud services such as Azure, this process will still work but may look slightly different. This guide will also <em>not</em> show you how to get an AWS account, they already have great <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/EC2_GetStarted.html">documentation</a>.</p>
<div class="section" id="get-a-fully-qualified-domain-name">
<h2>Get a Fully Qualified Domain Name<a class="headerlink" href="#get-a-fully-qualified-domain-name" title="Permalink to this headline">¶</a></h2>
<p>Before installation, you should choose a domain name and host to use to access your new POSM and configure it with your DNS provider. If you don’t do this, you won’t be able to access the OpenStreetMap interface.</p>
</div>
<div class="section" id="instance-setup">
<h2>Instance Setup<a class="headerlink" href="#instance-setup" title="Permalink to this headline">¶</a></h2>
<p>The first thing you will need to do is start a new instance. In your AWS EC2 Dashboard click on Launch instance. Scroll all the way down and find Ubuntu 18.04 LTS. The posm-build process only works on Ubuntu 18.04 at this time.</p>
<img alt="../../_images/ec2-ami.png" src="../../_images/ec2-ami.png" />
<p>After selecting your instance type you’ll need to fill out a couple more things. Recommended specs for your instance are:</p>
<blockquote>
<div><ul class="simple">
<li>We’ve used a t2.large</li>
<li><dl class="first docutils">
<dt>At least 2GB RAM, 8GB+ preferred</dt>
<dd><ul class="first last">
<li>If you use less than 8GB, you will not be able to run the OSM part of POSM</li>
<li>OpenMapKit Server runs happily on 2GB</li>
<li>If using SuperPOSM (OpenDroneMap), the more RAM the better</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>At least 10GB of attached storage</dt>
<dd><ul class="first last">
<li>Not an issue unless you have lots of photos or will be processing OpenDroneMap images</li>
</ul>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Open ports 22 and 80</dt>
<dd><ul class="first last">
<li>22 is needed to SSH into the server for administration and setup</li>
<li>80 is needed to view the various resources</li>
</ul>
</dd>
</dl>
</li>
</ul>
</div></blockquote>
</div>
<div class="section" id="configure-dns">
<h2>Configure DNS<a class="headerlink" href="#configure-dns" title="Permalink to this headline">¶</a></h2>
<p>After the instance is created, also create an elastic IP and assign it to the instance you just created. AWS has a <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/elastic-ip-addresses-eip.html#working-with-eips">guide</a> for this.</p>
<p>Now configure the DNS. Create an &#64; record and point it to the IP address that you just created and assigned to your instance.</p>
<p>Sample DNS records:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>my-posm.example.org     A     1.2.3.4
osm.my-posm.example.org CNAME my-posm.example.org
</pre></div>
</div>
</div>
<div class="section" id="posm-cloud-install">
<h2>POSM Cloud Install<a class="headerlink" href="#posm-cloud-install" title="Permalink to this headline">¶</a></h2>
<p>POSM Cloud uses posm-build to install because the live ubuntu instance for physical devices doesn’t work. The process take a little longer and requires a little bit of command line knowledge.</p>
<p>To configure POSM on your cloud host, <a class="reference external" href="http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/AccessingInstancesLinux.html">connect to it</a> using <cite>ssh</cite> and run the following commands.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># become root</span>
sudo -i

<span class="c1"># update instance for security patches</span>
apt-get update <span class="o">&amp;&amp;</span> apt-get upgrade

<span class="c1"># install git if necessary</span>
apt update <span class="o">&amp;&amp;</span> apt install --no-install-recommends -y git

<span class="c1"># clone this repository</span>
git clone https://github.com/AmericanRedCross/posm-build

<span class="c1"># edit your settings (posm_hostname, posm_domain)</span>
sensible-editor posm-build/kickstart/etc/settings
</pre></div>
</div>
<p>The important things to edit are <em>posm_hostname</em> and <em>posm_domain</em>. Set these equal to your hostname and domain that your purchased earlier. You can comfortably ignore all the wifi settings. You can enable basic auth for the whole site by uncommenting the <cite>auth=true</cite> on line 42 and editing the user and password to the desired values.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># network</span>
<span class="nv">posm_network</span><span class="o">=</span><span class="s2">&quot;172.16&quot;</span> <span class="c1"># class B</span>
<span class="nv">posm_wlan_subnet</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$posm_network</span><span class="s2">.1&quot;</span>
<span class="nv">posm_lan_subnet</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$posm_network</span><span class="s2">.2&quot;</span>
<span class="nv">posm_wlan_ip</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$posm_wlan_subnet</span><span class="s2">.1&quot;</span>
<span class="nv">posm_lan_ip</span><span class="o">=</span><span class="s2">&quot;</span><span class="nv">$posm_lan_subnet</span><span class="s2">.1&quot;</span>
<span class="nv">posm_wan_netif</span><span class="o">=</span><span class="s2">&quot;eth0&quot;</span>
<span class="nv">posm_lan_netif</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
<span class="nv">posm_wlan_netif</span><span class="o">=</span><span class="s2">&quot;wlan0&quot;</span>
<span class="nv">posm_ssid</span><span class="o">=</span><span class="s2">&quot;POSM&quot;</span>
<span class="nv">posm_wpa_passphrase</span><span class="o">=</span><span class="s2">&quot;awesomeposm&quot;</span> <span class="c1"># 8..63 characters</span>
<span class="nv">posm_wifi_channel</span><span class="o">=</span><span class="s2">&quot;1&quot;</span>
<span class="nv">posm_wifi_80211n</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="c1"># set to 0 to disable 802.11n</span>
<span class="nv">posm_wifi_wpa</span><span class="o">=</span><span class="s2">&quot;2&quot;</span> <span class="c1"># set to 0 to disable passwords</span>
<span class="nv">posm_hostname</span><span class="o">=</span><span class="s2">&quot;posm&quot;</span>
<span class="nv">posm_domain</span><span class="o">=</span><span class="s2">&quot;io&quot;</span>
<span class="nv">lan_domain</span><span class="o">=</span><span class="s2">&quot;lan&quot;</span>
<span class="nv">posm_fqdn</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">posm_hostname</span><span class="si">}</span><span class="s2">.</span><span class="si">${</span><span class="nv">posm_domain</span><span class="si">}</span><span class="s2">&quot;</span>
<span class="nv">osm_fqdn</span><span class="o">=</span><span class="s2">&quot;osm.</span><span class="si">${</span><span class="nv">posm_fqdn</span><span class="si">}</span><span class="s2">&quot;</span>

...

<span class="c1"># web</span>
<span class="c1"># auth=true # uncomment this to enable web authentication</span>
<span class="nv">auth_user</span><span class="o">=</span>POSM
<span class="nv">auth_password</span><span class="o">=</span>awesomeposm
</pre></div>
</div>
<p>The last thing is to install everything. This will take a while; go get a snack and come back.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/root/posm-build/kickstart/scripts/bootstrap.sh base virt nodejs ruby gis <span class="se">\</span>
  mysql postgis nginx osm fieldpapers docker omk tl carto tessera admin
</pre></div>
</div>
<p>The above command will install everything needed to run POSM Cloud but <em>will not install</em> OpenDroneMap.</p>
<p>To add SuperPOSM capabilities (OpenDroneMap + GeoTIFF processing), use the following instead.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>/root/posm-build/kickstart/scripts/bootstrap.sh base virt nodejs ruby gis <span class="se">\</span>
  mysql postgis nginx osm fieldpapers docker omk tl carto tessera admin <span class="se">\</span>
  redis opendronemap imagery
</pre></div>
</div>
</div>
<div class="section" id="omk-server-settings">
<h2>OMK Server Settings<a class="headerlink" href="#omk-server-settings" title="Permalink to this headline">¶</a></h2>
<p>OpenMapKit server does not apply authentication out of the box; you will need to set it up to ensure that sensitive information cannot be viewed on your cloud instance. This step requires more command line knowledge.</p>
<p>If the POSM cloud install was successful, then you should now be able edit your OMK server settings. You will need to uncomment the lines starting with “auth” and add in the credentials you would like.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sudo sensible-editor /etc/omk-server.js
</pre></div>
</div>
<p>Your screen should looks something like this.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;OpenMapKit Server&#39;</span><span class="p">,</span>
  <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;OpenMapKit Server&#39;</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">3210</span><span class="p">,</span>
  <span class="nx">dataDir</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/data&#39;</span><span class="p">,</span>
  <span class="nx">pagesDir</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/pages&#39;</span><span class="p">,</span>
  <span class="nx">hostUrl</span><span class="o">:</span> <span class="s1">&#39;http://omkserver.com&#39;</span><span class="p">,</span>
  <span class="nx">osmApi</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">server</span><span class="o">:</span> <span class="s1">&#39;http://osm.omkserver.com&#39;</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;POSM&#39;</span><span class="p">,</span>
      <span class="nx">pass</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>You’ll need to change it to look something like this.
<strong>Notice the added comma after the last `}` for osmApi</strong></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">name</span><span class="o">:</span> <span class="s1">&#39;OpenMapKit Server&#39;</span><span class="p">,</span>
  <span class="nx">description</span><span class="o">:</span> <span class="s1">&#39;OpenMapKit Server&#39;</span><span class="p">,</span>
  <span class="nx">port</span><span class="o">:</span> <span class="mi">3210</span><span class="p">,</span>
  <span class="nx">dataDir</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/data&#39;</span><span class="p">,</span>
  <span class="nx">pagesDir</span><span class="o">:</span> <span class="nx">__dirname</span> <span class="o">+</span> <span class="s1">&#39;/pages&#39;</span><span class="p">,</span>
  <span class="nx">hostUrl</span><span class="o">:</span> <span class="s1">&#39;http://omkserver.com&#39;</span><span class="p">,</span>
  <span class="nx">osmApi</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">server</span><span class="o">:</span> <span class="s1">&#39;http://osm.omkserver.com&#39;</span><span class="p">,</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;POSM&#39;</span><span class="p">,</span>
      <span class="nx">pass</span><span class="o">:</span> <span class="s1">&#39;&#39;</span>
  <span class="p">},</span>
  <span class="c1">// To do simple authentication, you can have an object like so:</span>
  <span class="nx">auth</span><span class="o">:</span> <span class="p">{</span>
      <span class="nx">user</span><span class="o">:</span> <span class="s1">&#39;username&#39;</span><span class="p">,</span>
      <span class="nx">pass</span><span class="o">:</span> <span class="s1">&#39;password&#39;</span>
  <span class="p">}</span>
<span class="p">};</span>
</pre></div>
</div>
<p>After saving, just reboot your server and authentication should be working when you go to OMK Server.</p>
</div>
<div class="section" id="success">
<h2>Success<a class="headerlink" href="#success" title="Permalink to this headline">¶</a></h2>
<p>After everything is configured you can go to your domain and you should see the following screen.</p>
<img alt="../../_images/posm-home.png" src="../../_images/posm-home.png" />
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../for-developers/" class="btn btn-neutral float-right" title="For Developers" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../troubleshooting/" class="btn btn-neutral" title="General troubleshooting" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright  CC-BY American Red Cross

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

  

  <script type="text/javascript" src="../../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>